# java-lotto-precourse

## 유의점

## 요구사항 분석
잘못된 입력에 대해 에러를 출력하고 다시 입력을 받아야 한다.

입력은 총 3회,
금액에 대한 입력과, 당첨 번호에 대한 입력, 보너스 번호에 대한 입력을 받아야 하고 각 상태는 저장되어야 하며

출력은 1회, 입력이 전부 완료되어 등록된 도메인 정보를 조합하여 다시 전송하여야 한다.  
이 행위로서 유추되는 바, 총 저장이 필요한 3개의 유즈케이스(서비스)가 생성될 것으로 유추되며 각 서비스가 하는 행동이 매우 많을 것으로 예상된다.  
따라서 각 유즈케이스(서비스)를 나누어 책임을 분산시키고 메인 서비스가 이를 통제하는 방향으로 설계한다.
각 유즈케이스(서비스)의 책임이 너무 많아지면 유지보수가 어려워지므로 적절히 나누어야 한다.  
그러나 너무 세분화하면 오히려 복잡도가 증가하므로 적절한 선에서 나누어야 한다.

1. 금액 입력 서비스 : 데이터의 및 리턴을 동시에 담당해야 하며, 추후 결과 출력을 위한 근거 로또 데이터도 저장해야 하므로 비즈니스 로직이 많아질 것으로 예상된다.
2. 당첨 번호 입력 서비스 : 입력 및 저장의 책임만 담당하므로 비즈니스 로직이 많지 않을 것으로 예상된다. 따라서 보너스 넘버 저장 메소드와 묶어서 하나의 서비스로 구성한다.
3. 게임 결과 출력 서비스 : 데이터의 리턴만 담당하지만, 기존의 도메인 데이터들을 가공해서 컨트롤러가 받을 수 있는 유의미한 데이터를 생성해야 하는 책임이 존재한다.따라서 하나의 서비스로 따로 구성한다.

출력을 위한 서비스도 매우 많은 비즈니스 로직을 포함할 것이 예상되는 바, 별도의 서비스로 분리하여 생성해야 한다.
메인 서비스가가 이 흐름을 통제하는 방향으로 가야만 한다.  
그리고 그 서비스에 대한 통제는 컨트롤러가 담당해야 한다.

#### 컨트롤러 익셉션 핸들러를 만들어야 한다.
잘못된 입력 발생시 예외를 던지는데 다시 리트라이를 해야 한다. 그리고 그 리트라이가 발생하는 지점은 입력시 발생하고;
따라서 입출력 포맷 검증시, 그리고 그 값이 유효한지 확인하는 도메인 검증시 모두 발생할 수 있다.  
그러므로 값의 포맷을 검증하는 컨트롤러와 값의 유효성을 검증하는 도메인 모두를 조작하는 컨트롤러가. 예외를 받고 리트라이하는 방향성은 타당한 것으로 판단된다.  
따라서 예외를 받고 재실행하는 책임을 컨트롤러의 각 행위 메소드에게 부여하여, 예외 발생시 다시 입력을 받도록 해야 한다.

이 행위는 입력을 실행하는 컨트롤러에게 매우 공통적인 행위이므로 컨트롤러 전용 핸들러 클래스를 정의하고 Runnable 인터페이스를 이용해
각 메소드를 씌워서 예외를 캐치하여 사용하는 방식으로 재사용성을 높이고
공통 포맷인 `[ERROR] ` 를 씌워서 출력하도록 하는 방향이 타당한 것으로 판단된다.

### 유의할 설계 포인트 분석

#### 최악의 상황을 대비하라
일단 우리나라 법률에 따르면 1인 최대 복권 구매 가격은 10만원이므로 최대 구매 가능 금액을 10만원으로 제한하였다.

만약 최대 구매 가능 액수범위 내에서 구입한 금액의 복권이 모두 1등에 당첨될 경우?
정말 말도 안되는 금액인 200억원 당첨금의 수익률을 계산해야 하는 상황이 발생한다. 이건 자바의 기본 자료형으로 처리할 수 없다.

천문학적인 확률의 최악을 배제하고, 효울을 챙기냐, 안전성을 챙기느냐의 트레이드 오프에서 안전성을 챙기는 쪽을 선택하였다.

이를 처리하려면 BigInteger을 채택하여 금액의 처리를 진행하여야 한다.
BigInterger의 연산 메소드를 활용하여 금액의 처리를 진행하도록 하자.

### 예외 발생 조건

예외를 입출력에서 다 던지는 것은 이 미션에서 발생할 수 있는 예외 요소들을 고려했을때 너무 방대해지고 책임이 쓸데없이 많아진다.
따라서 입출력시의 검증과 도메인에서 각 값의 검증을 맡게 하는 책임을 나누고 서비스에서는 비즈니스 로직에 집중하게 하는것이 타당하다는 판단을 내렸다.
그리고 그 책임의 분배는 다음과 같이 진행하기로 계획하였다.  
(물론 확장성을 고려한 널값 및 공백 검증은 모든 계층에서 한번씩 다 진행하는 세이프한 전략을 채택한다.)

1. 입출력부 검증 : 입력 포맷이 올바른지, 비어있는지, 숫자인지 등등을 체크한다. 포맷만 검증하고 도메인에서 실제 값의 유효성을 검증하도록 책임을 분배하였다.
   뷰는 입출력에만 집중해야 하므로 그 다음 계층이자 실제 값을 전달하는 주체인 컨트롤러가 이를 담당하도록 한다.
2. 도메인 검증 : 입력받은 값이 도메인에서 유효한 값인지 검증한다. 예를 들어 로또 번호가 1~45 사이의 숫자인지, 구입 금액이 1000원 단위인지 등등을 체크한다.

이 점을 유의해서 예외 처리의 분산을 진행하였다.

#### 구입 금액, 당첨 번호, 보너스 번호 입력시 공통 검증 케이스 (컨트롤러에서 걸러주어야 할 케이스)
1. 입력이 비어있는 경우
   입력받은 값이 비어있는 경우 예외를 발생시켜야 한다.
   이건 컨트롤러가 검증의 책임을 가진다.
2. 입력이 정수형 숫자 포맷이 아닌 경우
   입력받은 값이 숫자가 아닌 경우 예외를 발생시켜야 한다.
   이건 컨트롤러가 검증의 책임을 가진다.
3. 입력이 음수인 경우
   입력받은 값이 음수인 경우 예외를 발생시켜야 한다.
   이건 컨트롤러가 검증의 책임을 가진다.

#### 케이스별 검증 케이스

##### 금액 입력 케이스

###### 로또 금액이 1000원 단위가 아닐 경우
입력받은 로또 구입 금액이 1000으로 나누어 떨어지지 않으면 정확한 금액이 아니므로 예외를 발생시켜야 한다.  
이건 도메인이 검증의 책임을 가진다.

###### 입력한 구입 금액이 100000원을 초과할 경우
만약 입력받은 로또 구입 금액이 100000원을 초과할 경우 예외를 발생시켜야 한다.  
이건 도메인이 검증의 책임을 가진다.

##### 당첨 번호 입력 케이스

##### 입력한 당첨 번호가 유효한 범위의 숫자가 아닐 경우
로또 당첨 번호는 1부터 45까지의 숫자여야 한다.
입력받은 당첨 번호가 이 범위를 벗어날 경우 예외를 발생시켜야 한다.  
이건 당첨 번호 도메인이 검증의 책임을 가진다.

###### 입력한 보너스 번호가 유효한 범위의 숫자가 아닐 경우
로또 보너스 번호는 1부터 45까지의 숫자여야 한다.
입력받은 보너스 번호가 이 범위를 벗어날 경우 예외를 발생시켜야 한다.  
이건 보너스 넘버 도메인이 검증의 책임을 가진다.

##### 기타 도메인 검증 케이스
1. 로또 번호의 개수가 6개가 넘어가면 예외가 발생한다.  
   로또 도메인에게 검증의 책임을 부여한다.
2. 로또 번호에 중복된 숫자가 있으면 예외가 발생한다.  
   로또 도메인에게 검증의 책임을 부여한다.
3. 로또 번호가 유효한 범위가 아닐 경우에 예외가 발생한다.  
   로또 도메인에게 검증의 책임을 부여한다.

##### 출력시 검증 케이스
1. 입력이 전부 완료되어 정상적인 도메인 상태가 아님에도 출력을 요구할 경우 예외를 발생시켜야 한다.  
   이건 아직 급한 상황이 아니고 출력 요구가 없으므로 잠시 보류하나 추후에 추가를 고려한다.

#### 기능 명세서
##### InputView :
다음 출력 및 입력값 포맷을 준수해야 하고, 기능을 포함해야 함에 유의하여 설계한다.

- 구입 금액 입력 포맷
- 당첨 번호 입력 포맷
- 보너스 번호 입력 포맷


케이스는 총 3개가 있고 해당 역할을 충실히 실행하고 각 입력값을 리턴하는 역할을 담당한다.

##### OutputView :

- 구입 로또 갯수 출력 포맷
- 당첨 통계 출력 포맷
- 오류 출력 포맷

예외 출력부 제외, 모든 출력부는 개행을 한번 진행하고 출력하며, 각 출력 포맷을 준수해야 함에 유의하여 설계한다.

##### LottosService :
- 컨트롤러의 요청에 따라 다음 3개의 서비스를 호출하여 실행한다.
- 금액 입력 및 저장, 출력서비스
- 당첨 번호 및 보너스 번호 입력 및 저장 서비스
- 게임 결과 출력 서비스

##### PurchaseAmountService :
- 구입 금액을 입력받아 저장하는 기능을 담당한다.
- 구입 금액에 따라 구입 가능한 로또 갯수를 계산하여 저장하는 기능을 담당한다.
- 구입 금액에 따라 구입 가능한 로또 갯수를 리턴하는 기능을 담당한다.

##### WinningNumbersService :
- 당첨 번호를 입력받아 저장하는 기능을 담당한다.
- 보너스 번호를 입력받아 저장하는 기능을 담당한다.

##### GameResultService :
- 구입한 로또와 당첨 번호를 비교하여 당첨 통계를 계산하는 기능을 담당한다.
- 당첨 통계를 변환하여 리턴하는 기능을 담당한다.
- 수익률을 계산하는 기능을 담당한다.
- 수익률을 리턴하는 기능을 담당한다.

##### Domain Classes :
- PurchaseAmount : 구입 금액과 구입 가능한 로또 갯수를 저장하는 도메인 클래스
- Lotto : 로또 번호를 저장하는 도메인 클래스
- WinningNumbers : 당첨 번호와 보너스 번호를 저장하는 도메인 클래스
- GameResult : 당첨 통계와 수익률을 저장하는 도메인 클래스

##### Controller Exception Handler :
- 컨트롤러의 각 메소드에서 발생하는 예외를 처리하는 기능을 담당한다.
- 예외 발생시 `[ERROR] ` 포맷으로 출력하고 다시 입력을 받도록 하는 기능을 담당한다.
- 재사용성을 높이기 위해 Runnable 인터페이스를 활용하여 공통적인 예외 처리 로직을 구현한다.
- 컨트롤러의 각 메소드에서 이 핸들러를 활용하여 예외 처리를 수행한다.

##### LottoController :
- InputView와 OutputView를 활용하여 사용자와의 입출력을 담당한다.
- LottosService를 활용하여 비즈니스 로직을 수행한다.
- 각 입력 메소드에서 예외 발생시 컨트롤러 익셉션 핸들러를 활용하여 예외 처리를 수행한다.

##### Rank :
- 로또 당첨 등수를 나타내는 열거형 클래스
- 각 등수에 해당하는 당첨 갯수와 상금을 저장하는 기능을 담당한다.

##### RankTemplate :
- 로또 당첨 등수 통계를 저장하는 템플릿 클래스
- 각 등수에 해당하는 템플릿을 가지고 리턴하는 기능을 담당한다.
